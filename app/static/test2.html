<html>
	<head>
	    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <link rel="shortcut icon" href="theme/app/img/favicon.ico"/>
        
        <!-- IE 8 Compatibility -->
        <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />

        <link rel="stylesheet" type="text/css" href="externals/openlayers/theme/default/style.css" />
        <script type="text/javascript" src="script/OpenLayers.js"></script>
        
        <!-- Ext resources -->
        <link rel="stylesheet" type="text/css" href="externals/ext/resources/css/ext-all.css" />
        <link rel="stylesheet" type="text/css" href="externals/ext/resources/css/xtheme-gray.css" />
        <script type="text/javascript" src="externals/ext/adapter/ext/ext-base.js"></script>
        <script type="text/javascript" src="externals/ext/ext-all-debug.js"></script>

        <!-- OpenLayers resources -->
        <link rel="stylesheet" type="text/css" href="externals/openlayers/theme/default/style.css" />
        <script type="text/javascript" src="script/OpenLayers.js"></script>

        <!-- GeoExt resources -->
        <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/popup.css" />
        <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/layerlegend.css" />
        <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/gxtheme-gray.css" />
        <script type="text/javascript" src="script/GeoExt.js"></script> 

        <script type="text/javascript">
        function init() {
       		var tmpoptions = {
       			projection: "EPSG:32633",
       			units: 'm',
       			maxResolution: 10832.0,
       			maxExtent: new OpenLayers.Bounds(-2500000.0,3500000.0,3045984.0,9045984.0),
       			numZoomLevels: 18,
       			center: new OpenLayers.LonLat(1088474,8089849),
                zoom: 2
       		};
            var map = new OpenLayers.Map("map", tmpoptions);
            
            var gebco = new OpenLayers.Layer.WMS(
                "gebco",
                "http://crius.nodc.no:8080/geoserver/ows?service=wms&version=1.1.1",
                {layers: "gebco:gebco"},
                {isBaseLayer: true, visibility: false}
            );

            var geonorge = new OpenLayers.Layer.WMS(
            	"geonorge",
                "http://opencache.statkart.no/gatekeeper/gk/gk.open",
                {layers: "europa", format: "image/jpeg", transparent: true, isBaseLayer: true}
            );
            
            var npd = new OpenLayers.Layer.WMS(
                "NPD",
                "http://npdwms.npd.no/npdwmsmap_WGS84.asp",
                {layers: "Sub_areas,Blocks",transparent: "true",format: "image/png"},
                {isBaseLayer: false, visibility: false}
            );

            var korall = new OpenLayers.Layer.WMS(
                "SÃ¥rbare naturtyper", 
				"http://maps.nodc.no/cgi-bin/mapserv?map=wms/koraller.map",
				{layers: "coralreefs", format: "image/png", transparent: true},
				{isBaseLayer: false, visibility: false}
            );

        	var havbunnraster = new OpenLayers.Layer.WMS(
            	"Havbunnraster", 
                "http://wms.geonorge.no/skwms1/wms.havbunnraster2",
                {layers: "Havbunnraster", format: "image/png"},
    			{isBaseLayer: false, visibility: false}
            );    
            
            map.addLayers([geonorge,npd,korall,havbunnraster]);
            var theLayers = [korall, npd,havbunnraster];
            var merged = new Ext.tree.TreeNode({
            	title: "titleGoesHere",
            	text: "textGoesHere",
                checked: false,
                listeners: {
                	"checkchange": function(node, checked) {
                    	for (var i=theLayers.length-1;i>=0;--i) {
                    		theLayers[i].setVisibility(checked);
						}
					}
				}
			});
            var newLayerContainer = new GeoExt.tree.LayerContainer({
                text: "Temakart",
                group: "Temakart",
                iconCls: "gx-folder",
                expanded: true,
                tooltip: "Layer Properties",
                singleClickExpand: true,
                allowDrag: true,
                listeners: {
                    append: function(tree, node) {
                        node.expand();
                    }
                }
            });			

            mapPanel = new GeoExt.MapPanel({
                region: "center",
                map: map,
                layers: [gebco]
            });

            var treeRoot = new Ext.tree.TreeNode({
                text: "Layers",
                expanded: true,
                isTarget: false,
                allowDrop: false
            });
            //merged.appendChild(newLayerContainer);
            
            merged.appendChild(new GeoExt.tree.LayerNode({     
				layer: npd,
            	leaf: true,
            	loader: {
            		baseAttrs: {
            	    	radioGroup: 'theme',
            	        uiProvider: 'layernodeui'
					}
				}
            }));
            merged.appendChild(new GeoExt.tree.LayerNode({layer: korall}));
            merged.appendChild(new GeoExt.tree.LayerNode({layer: havbunnraster}));
            treeRoot.appendChild(merged);
            
            var tree = new Ext.tree.TreePanel({
                border: true,
                region: "west",
                title: "Layers",
                loader: new Ext.tree.TreeLoader(),
                width: 200,
                split: true,
                collapsible: true,
                collapseMode: "mini",
                autoScroll: true,
                root: treeRoot,
                rootVisible: false,
                lines: false, 
            	enableDD: true
            });
            
            new Ext.Viewport({
                layout: "border",
                items: [mapPanel,tree]
            });
            //mapPanel = Ext.getCmp("mappanel");
        }
		</script>
        
	</head>
	<body onload="init()">
		<div id="map" style="width: 600px; height: 300px"></div>
	</body>
</html>